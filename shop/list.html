<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
        <link href="css/public.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			 #nav{height:40px;background:#333;border-top:1px solid #d5d5d5;}
			#nav ul.left{float:left;}
			#nav ul.left li{float:left;font:12px/40px "";padding-left:6px;padding-right:6px;background:url(images/nav1.png) no-repeat right;}
			#nav ul.left li a{color:#929292;}
			#nav ul.left li:hover a{color:#fff;}



			#nav ul.left li.first{margin-left:0px;}


			#nav ul.right{float:right;}
			#nav ul.right li{float:left;font:12px/40px "";padding-left:6px;padding-right:6px;background:url(images/nav1.png) no-repeat right;}
			#nav ul.right li a{color:#929292;}
			#nav ul.right li.last a{color:red;}
			 
			.sum{float:right;width:30px;height:200px;}
			.sum h3 a{display:block;color:red;border:1px solid #000;text-align:center;}
			 
			 #cont{width:1020px;margin:0 auto;border-top:3px solid #ff6700;}
			.box{width: 250px;height:270px;margin-right:5px;margin-top:5px;padding-top:30px;float: left;border: solid 1px black;box-sizing: border-box;text-align: center;}
			.box img{width:40%;}
			.box p{margin: 10px 0;height: 40px;overflow: hidden;line-height: 20px;}
			.box em{display:block;width:100px;line-height: 26px;text-align: center;margin: 10px auto;font-style: normal;background: dodgerblue;color: #fff;}
		</style>
	</head>
	<body>
			<div id="nav">
					<ul class="left">
							 <li class="first"><a href="#">小米商城</a></li>
							 <li><a href="#">MIUI</a></li>
							 <li><a href="#">IoT</a></li>
							 <li><a href="#">云服务</a></li>
							 <li><a href="#">金融</a></li> 
							 <li><a href="#">有品</a></li>
							 <li><a href="#">小爱开放平台</a></li>
							 <li><a href="#">政企服务</a></li>
							 <li><a href="#">资质证照</a></li>
							 <li><a href="#">协议政策</a></li>
							 <li><a href="#">下载App</a></li>
							 <li class="last"><a href="#">Select Region</a></li>
					</ul>
			 <ul class="right">
							 <li><P><a href=http://localhost/%E5%B0%8F%E7%B1%B33/login/login.html>登录</a></P></li>
							 <li><P><a>欢迎<span>XXX</span>登录,<em id="exit">退出</em></a></P></li>
							 <li><p><a href=http://localhost/%E5%B0%8F%E7%B1%B33/login/register.html>注册</a></p></li>
							 <li><a href="#">消息通知</a></li>
							 <li class="last"><a href="car.html">购物车</a></li>
				</ul>
			</div>	
		   
       <div id="header">
        <img src="images/header1.png" class="logo">
        <img src="images/header2.png" class="water">
         <ol>
						 <li class="active"><a href="#">小米手机</a></li>
						 <li><a href="#">红米</a></li>
							<li><a href="#">电视</a></li>
							<li><a href="#">笔记本</a></li>
							<li><a href="#">家电</a></li>
							<li><a href="#">新品</a></li>
							<li><a href="#">路由器</a></li>
							<li><a href="#">智能硬件</a></li>
							<li><a href="#">服务</a></li>
							<li><a href="#">社区</a></li>
          </ol>
				      
        <div class="search">
          <input type="text" id="txt">
          <input type="submit" value="" id="sub">
        </div>

    </div>
    
  
       <div class="sum">
		       <h3><a href="car.html">去结算</a></h3>
       </div> 
				
	 
		<div id="cont">
			<!--<div class="box">
				<img src=""/>
				<p></p>
				<b></b>
				<span></span>
			</div>-->
		</div>
        
	
        <div id ="bottom">
        
			   <ul class="bottom-t">
			     <li><b><img src="images/bottom1.png"></b><span>预约维修服务</span></li>
                 <li><b><img src="images/bottom2.png"></b><span>7天无理由退货</span></li>
                 <li><b><img src="images/bottom3.png"></b><span>15天免费换货</span></li>
                 <li><b><img src="images/bottom4.png"></b><span>满150元包邮</span></li>
                 <li class="last"><b><img src="images/bottom6.png"></b><span>520余家售后网点</span></li>
			   </ul>
               
               
               <div class="bottom-b">
                 <dl class="first">
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl> 
                 
                 <dl> 
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl>
                  
                  <dl>
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl> 
                 
                 <dl> 
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl>
                   
                   <dl>
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl> 
                 
                 <dl class="last"> 
                   <dt>帮助中心</dt>
                   <dd>账户管理</dd>
                   <dd>购物指南</dd>
                   <dd>订单操作</dd>
                 </dl>
               </dl>
              </div>
              
              
              <div class="bottom-b-r">
                   <h3>400-100-5678</h3>
                   <p>周一至周日 8:00-18:00</p>
                   <p>(仅收市话费)</p>
                   <h6>联系客服</h6>
							</div>
							
								
		</div>
	</body>
	<script src="libs/ajax.3.0.js" type="text/javascript" charset="utf-8"></script>
	<script src="libs/cookie.js" type="text/javascript" charset="utf-8"></script>
	<script src="../jquery.2.2.4.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		//登录
		class Index{
			constructor(){
				this.p = document.querySelectorAll("#nav .right li p");
				console.log(this.p)
				this.span = document.querySelector("#nav .right li p a span");
				console.log(this.span);
				this.exit = document.querySelector("#nav .right li p a #exit")
					console.log(this.exit)
				this.getData()
				this.addEvent();
				
			}
			getData(){
				this.abc = localStorage.getItem("abc");
				// 读取localStorage，如果有就解析成数组，如果没有就给一个空数组，方便操作
				if(this.abc == null){
					this.abc = [];
				}else{
					this.abc = JSON.parse(this.abc)
				}
				this.panduan()
			}
			panduan(){
				for(var i=0;i<this.abc.length;i++){
					if(this.abc[i].onoff == 1){
						this.p[0].style.display = "none";
						this.p[1].style.display = "block";
						this.p[2].style.display = "none";
						this.span.innerHTML = this.abc[i].user;
						this.successUser = this.abc[i].user;
						return;
					}
				}
				this.p[0].style.display = "block";
				this.p[1].style.display = "none";
				this.p[2].style.display = "block";
				this.span.innerHTML = "";
				var that = this;
				setTimeout(function(){
								alert("请登录后再购买！");
								that.aa();
							},3000)
			}
			aa(){
				for(var i=0;i<this.abc.length;i++){
					if(this.p[0].style.display = "none"){
				  	location.href="http://localhost/%E5%B0%8F%E7%B1%B33/login/register.html";
				      
		      	}
			 	}
			}
		
			addEvent(){
				var that = this;
				this.exit.onclick = function(){
					if(that.successUser){
						for(var i=0;i<that.abc.length;i++){
							if(that.abc[i].user === that.successUser){
								that.abc[i].onoff = 0;
								localStorage.setItem("abc",JSON.stringify(that.abc))
								that.panduan();
							}
						}
					}
				}
			}
		}

	new Index();


	class List{
			constructor(options){
//				1.解析参数
				this.cont = options.cont;
				this.url = options.url;
				
//				2.请求数据
				this.load();
				
//				5.绑定事件
				this.addEvent();
			}
			load(){
				var that = this;
				ajax({
					url:this.url,
					success:function(res){
//						3.请求成功之后解析数据,并渲染页面
						that.res = JSON.parse(res)
						that.display()
					}
				})
			}
			display(){
//				4.遍历数据,拼接结构,渲染页面
				var str = "";
				for(var i=0;i<this.res.length;i++){
					str += `<div class="box" index="${this.res[i].goodsId}">
								<img src="${this.res[i].src}"/>
								<p>${this.res[i].name}</p>
								<span>${this.res[i].price}</span>
								<em>加入购物车</em>
							</div>`;
				}
				this.cont.innerHTML = str;
			}
			addEvent(){
				var that = this;
				this.cont.addEventListener("click",function(eve){
					if(eve.target.nodeName == "EM"){
//						6.被点击时,获取货号,存cookie
						that.id = eve.target.parentNode.getAttribute("index");
						that.setCookie()
						alert("加入成功!");
					}
				})
			}
			
			
			setCookie(){
//				因为要使用一条cookie存商品,所以数据选择数组里面放对象[{},{}]
				this.goods = getCookie("goods");
//				情况1:第一次添加
				if(this.goods == ""){
					this.goods = [{
						id:this.id,
						num:1
					}];
				}else{
//					情况2:不是第一次添加
					this.goods = JSON.parse(this.goods);
//					新情况1：这次点击的是老数据
					var onoff = true;
					this.goods.forEach((v)=>{
						if(v.id == this.id){
							v.num++
							onoff = false;
						}
					})
					
//					新情况2：这次点击的是新数据
					if(onoff){
						this.goods.push({
							id:this.id,
							num:1
						})
					}
				}
//				所有关于数组的操作结束之后,将数组转成字符再设置到cookie中
				setCookie("goods",JSON.stringify(this.goods))
			}
		}
		
		new List({
			cont:document.getElementById("cont"),
			url:"http://localhost/小米3/shop/data/shanping.json"
		})
		
	</script>
</html>
